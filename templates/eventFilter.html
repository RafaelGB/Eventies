{% extends 'base.html' %}

{% load assign_tag %}
{% load staticfiles %}
{% load static %}

{% block title %}Búsqueda{% endblock %}


{% block stylesheet %}<!-- opcion de estilo -->
	<link rel="stylesheet" href="{% static 'css/filterEvents.css' %}">	
	<link rel="stylesheet" href="{% static 'css/bootstrap-tagsinput.css' %}">
	<link rel="stylesheet" href="{% static 'css/simplemde.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/typeaheadjs.css' %}">
	<link rel="stylesheet" href="{% static 'css/bootstrap-select.css' %}">
{% endblock %} <!-- fin de opcion de estilo -->

{% block javascript %}
	<script src="{% static 'js/bootstrap-select.js' %}"></script>
{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
  <li class="breadcrumb-item active">{% if view.kwargs.type == 'own' %}Mis{% else %}Filtro de{% endif %} eventos</li>
{% endblock %}

{% block content %}
	<div class="container-fluid">
	  <div class="row content">
	    <div class="col-sm-3 sidenav">
	      <h4>Herramientas de filtrado</h4>     	
	      	<form action="" id="filterForm" method="GET">
	      	  	<a href="{% url 'eventFilter' type='all' %}">
		    		<span class="glyphicon glyphicon-trash"></span>
		    	</a>
	      	    <button type="submit">
				   <span class="glyphicon glyphicon-filter"></span>
				</button>
				
				<hr>
				
				<div class="input-group">


				<!-- filtro por proximidad  -->
				<ul class="nav nav-pills nav-stacked">	
					<li>
					    <label>Distancia</label>
				  			<input type="number" name="distance" min="100" max="50000" value="{{ distance }}">
				  		<label> metros</label>
					    <input type="hidden" name="lng"  id="campo_lng">
					    <input type="hidden" name="lat"  id="campo_lat">
				    </li>
					<li>
				    </li>
				</ul>
			    </div>   
		    </form>

		    <hr>
		    <label>Categorías</label>
		    <select form="filterForm" name="categories" id="first-disabled2" class="form-control selectpicker" multiple data-hide-disabled="true" data-size="5">
			    {% for category in allCategories %}
			      <option>{{ category }}</option>
			    {% endfor %}
	  		</select>

		    <hr>

		    <label>Etiquetas</label>
	  		<input placeholder="<etiqueta> (pulsa enter...)" type="text"  id="tags_input" value="" form="filterForm" name="tags" data-role="tagsinput" />


	  		<hr>

		    <a href="{% url 'eventFilter' type='all' %}">
		    	<span class="glyphicon glyphicon-trash"></span>
		    </a>	    
		    <button type="submit" form="filterForm">
				   <span class="glyphicon glyphicon-filter"></span>
			</button> 
	    </div>

	    <div class="col-sm-9">
		{% include 'includes/pagination.html' %}
	    {% if events %}
	            
	    <ul>
	      {% assign count 0 %}<!-- creamos un contador para controlar la extension de la fila -->
	      {% for event in events %}
	      	{% ifequal count 0 %}    
		  			<div class="row">
	  		{% endifequal %}
				  		<a href="/{% if view.kwargs.type == 'own' %}updateEvent{% else %}event{% endif %}/{{ event.pk }}">

				  		<div class="col-sm-4">
				      		<div class="panel panel-primary"><!-- panel-danger panel-success disponibles -->
						        <div class="panel-heading">{{ event.title }}</div>
						        <div class="panel-body"><img src="https://placehold.it/150x80?text=IMAGE" class="img-responsive" style="width:100%" alt="Image"></div>
						        <div class="panel-footer">{{event.summary}}</div>
				      		</div>
				    	</div>
				    	</a>
	    	{% ifequal count 2 %}
		    		</div>
	  			{% assign count 0 %}<!-- reseteamos contador -->
	  		{% else %}
	  			{% increment count %}<!-- count++ -->
	  		{% endifequal %}
	  		
	      {% endfor %}
			<br>
	    </ul>
	    {% else %}
	      <p>No se han encontrado coincidencias con su búsqueda</p>
	    {% endif %} 

		{% include 'includes/pagination.html' %}

	    </div>
	  </div>
	</div>


{% endblock %}
{% block javascriptBottom %}
	<script src="{% static 'js/bootstrap-tagsinput.js' %}"></script>
	
	<script src="{% static 'js/typeahead.bundle.js' %}"></script>
	
	<script>
	  var tags = new Bloodhound({
	  datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d.name_tag); },
	  queryTokenizer: Bloodhound.tokenizers.whitespace,
	  local:{{autoTags|safe}}
	});

	  tags.initialize();

	  $('#tags_input').tagsinput({
	    typeaheadjs: {
	    name: 'tags',
	    displayKey: 'name_tag',
	    source: tags.ttAdapter()
	    }
	  });
	</script>

	
    <script>
	    if (navigator.geolocation) {
	    	var pos;
		    navigator.geolocation.getCurrentPosition(function(position) {
			    pos = {
			      lat: position.coords.latitude,
			      lng: position.coords.longitude
			    };
			    var getLong = document.getElementById("campo_lng");
			    var getLat = document.getElementById("campo_lat");
			    getLong.setAttribute("value", pos.lat /* la posición desde Javascript en el cliente */);
			    getLat.setAttribute("value", pos.lng /* la posición desde Javascript en el cliente */);
		  	});
		    
	    }else{
	    	alert("no se ha dado permisos de localización");
	    }
    </script>

	<script>
	  $(document).ready(function () {
	    var mySelect = $('#first-disabled2');

	  });
	</script>

{% endblock %}
